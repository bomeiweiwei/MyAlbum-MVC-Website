@model IEnumerable<MyAlbum.Models.AlbumPhoto.AlbumPhotoDto>

@{
    ViewData["Title"] = "相片管理";
    Layout = "~/Views/Shared/_MemberLayout.cshtml";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">@ViewData["Title"]</h3>
    @{
        Guid albumId = Guid.Empty;
        var data = Model.FirstOrDefault();
        if (data != null)
            albumId = data.AlbumId;
    }
    <!-- 新增相片鈕 -->
    <a class="btn btn-primary"
       asp-area="Member"
       asp-controller="AlbumPhoto"
       asp-route-albumId="@albumId"
       asp-action="Create">
        + 新增相片
    </a>
</div>

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-12 col-md-4 mb-3">
            <div class="card" style="width:100%;">
                <img class="card-img-top preview-img"
                     src="@item.PublicPathUrl"
                     data-full="@item.PublicPathUrl"
                     style="height:240px; object-fit:cover; cursor:pointer;"
                     alt="@item.Title">
                <div class="card-body d-flex flex-column">
                    <p class="card-text text-secondary mb-1">評論數量：@item.CommentNum</p>
                    <p class="card-text text-secondary mb-3">發佈時間：@item.CreatedAtUtc.ToLocalTime()</p>
                    <p class="mb-3">
                        狀態：
                        @if (item.Status == MyAlbum.Shared.Enums.Status.Active)
                        {
                            <span class="badge bg-success">啟用</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">停用</span>
                        }
                    </p>

                    <div class="mt-auto d-flex gap-2">
                        <!-- 留言檢視按鈕 -->
                        <a class="btn btn-outline-primary btn-sm"
                           asp-area="Member"
                           asp-controller="AlbumComment"
                           asp-action="Index"
                           asp-route-albumId="@item.AlbumId">
                            留言檢視
                        </a>
                        <!-- 編輯 -->
                        <a class="btn btn-outline-secondary btn-sm"
                           asp-area="Member"
                           asp-controller="AlbumPhoto"
                           asp-action="Edit"
                           asp-route-albumPhotoId="@item.AlbumPhotoId">
                            編輯
                        </a>
                        @if (item.Status == MyAlbum.Shared.Enums.Status.Active)
                        {
                            <form asp-area="Member"
                                  asp-controller="AlbumPhoto"
                                  asp-action="Disable"
                                  asp-route-albumPhotoId="@item.AlbumPhotoId"
                                  asp-route-albumId="@item.AlbumId"
                                  method="post"
                                  class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="btn btn-outline-danger btn-sm"
                                        onclick="return confirm('確定要停用此相片嗎？');">
                                    停用
                                </button>
                            </form>
                        }
                        else
                        {
                            <form asp-area="Member"
                                  asp-controller="AlbumPhoto"
                                  asp-action="Active"
                                  asp-route-albumPhotoId="@item.AlbumPhotoId"
                                  asp-route-albumId="@item.AlbumId"
                                  method="post"
                                  class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="btn btn-outline-danger btn-sm">
                                    啟用
                                </button>
                            </form>
                        }

                    </div>
                </div>
            </div>
        </div>
    }
</div>

<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-transparent border-0">
            <img id="modalImage" class="w-100 rounded">
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.preview-img').forEach(img => {
        img.addEventListener('click', function () {
            const fullImageUrl = this.dataset.full;
            document.getElementById('modalImage').src = fullImageUrl;

            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            modal.show();
        });
    });
</script>